def run_agent():
    matches = get_matches()
    df_all, finished_df = build_df(matches)
    odds_df = get_odds()
    upcoming_df = df_all[df_all['status']=='SCHEDULED'].copy()
    today_str = datetime.now().strftime("%Y-%m-%d")

    overall_report = f"ðŸ“Š **Raport AI Agent - {today_str}**\n"

    for comp in df_all['competition'].unique():
        comp_finished = finished_df[finished_df['competition']==comp].copy()
        if len(comp_finished) < 5:
            continue
        comp_upcoming = upcoming_df[upcoming_df['competition']==comp].copy()
        if comp_upcoming.empty:
            continue

        overall_report += f"\nðŸ† **{comp}**\n"
        for col in ["over25","btts"]:
            comp_finished, model = train_model(comp_finished, col)
            if model is None:
                overall_report += f"âš ï¸ Nie udaÅ‚o siÄ™ wytrenowaÄ‡ modelu dla {col}\n"
                continue

            value_bets = filter_value_bets(comp_upcoming, comp_finished, odds_df, col)

            if len(value_bets) == 0:
                overall_report += f"âŒ Brak pewnych typÃ³w dla {col}\n"
            else:
                for _, row in value_bets.iterrows():
                    msg = (
                        f"âš½ **{row.competition}: {row.home} vs {row.away} ({today_str})**\n"
                        f"ðŸŽ¯ Typ: {col.upper()}\n"
                        f"ðŸ“Š PewnoÅ›Ä‡ AI: {round(row[f'{col}_conf']*100,2)}%\n"
                        f"ðŸ’° Kurs: {row[col]}\n"
                        f"ðŸ§  AI Agent"
                    )
                    send_discord(msg)
                overall_report += f"âœ… Znaleziono {len(value_bets)} pewnych typÃ³w dla {col}\n"

    # WyÅ›lij podsumowanie dnia niezaleÅ¼nie od typÃ³w
    send_discord(overall_report)
